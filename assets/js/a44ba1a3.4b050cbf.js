"use strict";(self.webpackChunkshuvi_document=self.webpackChunkshuvi_document||[]).push([[5230],{9613:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var i=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),c=p(n),g=r,m=c["".concat(s,".").concat(g)]||c[g]||d[g]||o;return n?i.createElement(m,l(l({ref:t},u),{},{components:n})):i.createElement(m,l({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=c;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:r,l[1]=a;for(var p=2;p<o;p++)l[p]=n[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5846:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>p});var i=n(2081),r=(n(9496),n(9613));const o={id:"plugin",title:"Plugin",sidebar_position:5},l=void 0,a={unversionedId:"guides/plugin",id:"guides/plugin",title:"Plugin",description:"What is plugin?",source:"@site/docs/guides/plugin.md",sourceDirName:"guides",slug:"/guides/plugin",permalink:"/shuvijs.org/docs/guides/plugin",draft:!1,editUrl:"https://github.com/shuvijs/shuvijs.org/tree/master/docs/guides/plugin.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"plugin",title:"Plugin",sidebar_position:5},sidebar:"guides",previous:{title:"Custom Document Template",permalink:"/shuvijs.org/docs/guides/custom-behaviors/custom-document-template"},next:{title:"Deploy",permalink:"/shuvijs.org/docs/guides/Deploy"}},s={},p=[{value:"What is plugin?",id:"what-is-plugin",level:2},{value:"Write plugins",id:"write-plugins",level:2},{value:"CorePlugin",id:"coreplugin",level:3},{value:"ServerPlugin",id:"serverplugin",level:3},{value:"RuntimePlugin",id:"runtimeplugin",level:3},{value:"Extended Type Declaration &amp; TypeScript Support",id:"extended-type-declaration--typescript-support",level:3},{value:"Configure plugins",id:"configure-plugins",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"what-is-plugin"},"What is plugin?"),(0,r.kt)("p",null,"Shuvi.js has a built-in plugin system, which connects the running process of the entire framework through a series of lifecycle hooks, and allows developers and users to add custom behaviors to the hooks to add more functions."),(0,r.kt)("p",null,"There are 3 types of plugins which are corePlugin, serverPlugin and runtimePlugin."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"corePlugin: modify the process of building"),(0,r.kt)("li",{parentName:"ul"},"serverPlugin: modify bahavior of the server"),(0,r.kt)("li",{parentName:"ul"},"runtimePlugin: modify or extend runtime component and context")),(0,r.kt)("h2",{id:"write-plugins"},"Write plugins"),(0,r.kt)("p",null,"These plugins can be used alone or in combination to achieve certain functions."),(0,r.kt)("p",null,"For example, if we want to develop a plugin that automatically introduce redux store to the app, all these 3 plugins are needed together to make this feature work."),(0,r.kt)("p",null,"No matter which plugins are used in ",(0,r.kt)("strong",{parentName:"p"},"the final plugin"),", we hope that ",(0,r.kt)("strong",{parentName:"p"},"the final plugin")," can provide a unified and convenient way of exporting and configuring."),(0,r.kt)("p",null,"In this way, we stipulate a specification for writing ",(0,r.kt)("strong",{parentName:"p"},"the final plugins"),", that."),(0,r.kt)("p",null,"A plugin is a collection of files as the following."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pluginDirectory/\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 server.js\n\u251c\u2500\u2500 runtime.js\n\u2514\u2500\u2500 types.d.ts\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"index.js"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"server.js")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"runtime.js")," represent corePlugin, serverPlugin and runtimePlugin."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"types.d.ts")," describes what types are extended by this plugin."),(0,r.kt)("p",null,"These files are not completely required, but are used as needed."),(0,r.kt)("p",null,"Each plugin file exports a plugin instance object which is created by corresponding creater."),(0,r.kt)("p",null,"The plugins could be also configured with options. In this way, each plugin exports a function that receives the passed options and returns plugin instance."),(0,r.kt)("p",null,"If a plugin is provided as an npm package, these 4 files should be listed on 'exports' field at ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," as the following."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "exports": {\n    ".": "./dist/index.js",\n    "./server": "./dist/server.js",,\n    "./runtime": "./dist/runtime.js",,\n    "./types": "./dist/types.js",\n  }\n}\n')),(0,r.kt)("h3",{id:"coreplugin"},"CorePlugin"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," exports corePlugin"),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="index.js"',title:'"index.js"'},"const { createCorePlugin } = require('shuvi')\n\nmodule.exports = createCorePlugin({\n  afterInit: (context) => {\n    // do something\n  }\n}, {\n  name: 'corePlugin'\n})\n\n// or with options\nmodule.exports = (options) => createCorePlugin({\n  afterInit: (context) => {\n    // do something\n  }\n}, {\n  name: 'corePlugin'\n})\n")),(0,r.kt)("h3",{id:"serverplugin"},"ServerPlugin"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"server.js")," exports serverPlugin"),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server.js"',title:'"server.js"'},"const { createServerPlugin } = require('shuvi')\n\nmodule.exports = createServerPlugin({\n  onListen: ({ port, hostname }, context) => {\n    // do something\n  }\n}, {\n  name: 'serverPlugin'\n})\n\n// or with options\n\nmodule.exports = (options) => createServerPlugin({\n  onListen: ({ port, hostname }, context) => {\n    // do something\n  }\n}, {\n  name: 'serverPlugin'\n})\n\n")),(0,r.kt)("h3",{id:"runtimeplugin"},"RuntimePlugin"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"runtime.js")," exports runtimePlugin"),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="runtime.js"',title:'"runtime.js"'},"const { createPlugin } = require('@shuvi/platform-shared/lib/runtime')\n\nmodule.exports = createPlugin({\n  init: () => {\n    // do something\n  }\n}, {\n  name: 'runtimePlugin'\n})\n\n// or with options\nmodule.exports = (options) => createPlugin({\n  init: () => {\n    // do something\n  }\n}, {\n  name: 'runtimePlugin'\n})\n\n")),(0,r.kt)("h3",{id:"extended-type-declaration--typescript-support"},"Extended Type Declaration & TypeScript Support"),(0,r.kt)("p",null,"If plugin extends some of the plugin hooks or interface, a ",(0,r.kt)("inlineCode",{parentName:"p"},"types.d.ts")," is needed to ensure types correct elsewhere. It means that the extended types will also be useful for ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-runtime"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-server")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-document"),"."),(0,r.kt)("p",null,"And we recommend you to write plugins with TypeScript to get a better writing experience."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="hooks.ts"',title:'"hooks.ts"'},"import { createSyncHook } from '@shuvi/hook'\nexport const extendedHook = createSyncHook<void>()\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server.ts"',title:'"server.ts"'},"import { createServerPlugin } from 'shuvi'\nimport { extendedHook } from './hooks'\n\nexport default createServerPlugin({\n  setup({ addHooks } => {\n    addHooks({ extendedHook })\n  }),\n  pageData: appContext => {\n    const { test } = appContext;\n    return {\n      test\n    };\n  }\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="runtime.ts"',title:'"runtime.ts"'},"import { createPlugin } from '@shuvi/platform-shared/lib/runtime'\nexport default createPlugin({\n  getAppContext: ctx => {\n    ctx.test = 'test'\n    return ctx;\n  }\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=\"types.ts (will be 'types.d.ts' after compiled)\"",title:'"types.ts',"(will":!0,be:!0,"'types.d.ts'":!0,after:!0,'compiled)"':!0},"import { extendedHook } from './hooks'\n\ndeclare module '@shuvi/runtime' {\n  export interface CustomServerPluginHooks {\n    extendedHook: typeof extendedHook\n  }\n\n  export interface CustomAppContext {\n    test: string\n  }\n}\n")),(0,r.kt)("p",null,"The above is a complete example with TypeScript. This plugin has a serverPlugin and a runtimePlugin. The serverPlugin extended a ",(0,r.kt)("inlineCode",{parentName:"p"},"extendedHook"),", and the runtimePlugin added a property to ",(0,r.kt)("inlineCode",{parentName:"p"},"appContext")," through the hook ",(0,r.kt)("inlineCode",{parentName:"p"},"getAppContext"),". And the relevant type extensions are also declared in ",(0,r.kt)("inlineCode",{parentName:"p"},"types.ts")," which will be compiled as ",(0,r.kt)("inlineCode",{parentName:"p"},"types.d.ts"),"."),(0,r.kt)("admonition",{title:"About module formats",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"CorePlugin and serverPlugin is needed to be commonjs modules as they will be executed as shuvi starts without being compiling. While runtimePlugins could be whatever es module or commonjs modules because they will be compiled during building of the application.")),(0,r.kt)("admonition",{title:"About options",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"If plugin options are set, they will be passed into every plugin generator and get the actual plugin instance. But runtimePlugins runs on client side so that options must be serializable variable.")),(0,r.kt)("p",null,"For more detailed plugin api, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/shuvijs.org/docs/old-reference/plugin/hook-api"},"reference/plugin"),"."),(0,r.kt)("h2",{id:"configure-plugins"},"Configure plugins"),(0,r.kt)("p",null,"As long as plugin is ready, those plugins could be configured at ",(0,r.kt)("inlineCode",{parentName:"p"},"shuvi.config.js"),"."),(0,r.kt)("p",null,"If the plugin is a package, please ensure it is installed in the project."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="shuvi.config.js"',title:'"shuvi.config.js"'},"export default {\n  plugins: [\n    'path/to/pluginDirectory',\n    'plugin-package-name'\n  ]\n")),(0,r.kt)("p",null,"If plugins have options, they should be configured as"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="shuvi.config.js"',title:'"shuvi.config.js"'},"export default {\n  plugins: [\n    ['path/to/pluginDirectory', 'options'],\n    ['plugin-package-name', { options: { someFields: 'someFields' } }]\n  ]\n}\n")),(0,r.kt)("p",null,"For more detailed plugin configuring api, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/shuvijs.org/docs/old-reference/config#plugins"},"api/shuvi.config.js/plugin"),"."))}d.isMDXComponent=!0}}]);