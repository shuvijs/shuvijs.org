"use strict";(self.webpackChunkshuvi_document=self.webpackChunkshuvi_document||[]).push([[5216],{9613:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(k,o(o({ref:t},u),{},{components:n})):a.createElement(k,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7518:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(665),r=(n(9496),n(9613));const i={sidebar_position:2,id:"Api Routes"},o=void 0,l={unversionedId:"guide/Conventional-Routes/Api Routes",id:"guide/Conventional-Routes/Api Routes",title:"Api Routes",description:"API Routes",source:"@site/docs/guide/Conventional-Routes/api-routes.md",sourceDirName:"guide/Conventional-Routes",slug:"/guide/Conventional-Routes/Api Routes",permalink:"/shuvijs.org/docs/guide/Conventional-Routes/Api Routes",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/guide/Conventional-Routes/api-routes.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,id:"Api Routes"},sidebar:"guideSidebar",previous:{title:"Routes",permalink:"/shuvijs.org/docs/guide/Conventional-Routes/Routes"},next:{title:"Middleware",permalink:"/shuvijs.org/docs/guide/Conventional-Routes/Middleware"}},s={},p=[{value:"API Routes",id:"api-routes",level:2},{value:"Usage",id:"usage",level:3},{value:"Example",id:"example",level:3},{value:"enhanced request",id:"enhanced-request",level:3},{value:"Custom config",id:"custom-config",level:3},{value:"enhanced response",id:"enhanced-response",level:3}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"api-routes"},"API Routes"),(0,r.kt)("p",null,"API routes provide a solution to build your ",(0,r.kt)("strong",{parentName:"p"},"API")," with shuvi."),(0,r.kt)("p",null,"Any file inside the folder ",(0,r.kt)("inlineCode",{parentName:"p"},"src/routes"),", each api is associated with a route based on its file name. They are server-side only bundles and won't increase your client-side bundle size."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"path"),(0,r.kt)("th",{parentName:"tr",align:null},"route"),(0,r.kt)("th",{parentName:"tr",align:null},"matched url"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"routes/api/post/create/api.js"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/create"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/create")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"routes/api/post/","[pid]","/api.js"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/:pid"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/1, /api/post/abc")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"routes/api/post/[","[pid]","]/api.js"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/:pid?"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post, /api/post/1, /api/post/abc")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"routes/api/post/","[...pid]","/api.js"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/:pid+"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/1/2, /api/post/a/b/c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"routes/api/post/[","[...pid]","]/api.js"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post/:pid*"),(0,r.kt)("td",{parentName:"tr",align:null},"/api/post, /api/post/1/2, /api/post/a/b/c")))),(0,r.kt)("h3",{id:"usage"},"Usage"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a ",(0,r.kt)("inlineCode",{parentName:"li"},"api.js")," file under your ",(0,r.kt)("inlineCode",{parentName:"li"},"routes")," directory."),(0,r.kt)("li",{parentName:"ol"},"Finally, export an api function from the ",(0,r.kt)("inlineCode",{parentName:"li"},"api.js")," file by default.")),(0,r.kt)("h3",{id:"example"},"Example"),(0,r.kt)("p",null,"For example, the following API route ",(0,r.kt)("inlineCode",{parentName:"p"},"routes/api/user/api.js")," returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"json")," response with a status code of ",(0,r.kt)("inlineCode",{parentName:"p"},"200"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default function handler(req, res) {\n  res.status(200).json({ name: 'John Doe' })\n}\n")),(0,r.kt)("p",null,"For an API route to work, you need to export a function as default (a.k.a ",(0,r.kt)("strong",{parentName:"p"},"request handler"),"), which then receives the following parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"req"),": An instance of ",(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/api/http.html#http_class_http_incomingmessage"},"http.IncomingMessage"),", plus some ",(0,r.kt)("a",{parentName:"li",href:"#enhanced-request"},"enhanced request")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"res"),": An instance of ",(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/api/http.html#http_class_http_serverresponse"},"http.ServerResponse"),", plus some ",(0,r.kt)("a",{parentName:"li",href:"#enhanced-response"},"enhanced response"))),(0,r.kt)("p",null,"To handle different HTTP methods in an API route, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"req.method")," in your request handler, like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { RuntimeServer } from '@shuvi/runtime'\nconst apiHandler: RuntimeServer.IApiRequestHandler = function handler(req, res) {\n  if (req.method === 'POST') {\n    // Process a POST request\n  } else {\n    // Handle any other HTTP method\n  }\n}\nexport default apiHandler\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Details of ",(0,r.kt)("inlineCode",{parentName:"p"},"RuntimeServer.IApiRequestHandler")," types is ",(0,r.kt)("a",{parentName:"p",href:"/shuvijs.org/docs/api/runtime/modules/RuntimeServer#iapirequesthandler"},"here"))),(0,r.kt)("p",null,"To fetch API endpoints, take a look into any of the examples at the start of this section."),(0,r.kt)("h3",{id:"enhanced-request"},"enhanced request"),(0,r.kt)("p",null,"API routes provide built in middlewares which parse the incoming request (",(0,r.kt)("inlineCode",{parentName:"p"},"req"),"). Those middlewares are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"req.cookies")," - An object containing the cookies sent by the request. Defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"{}")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"req.query")," - An object containing the ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Query_string"},"query string"),". Defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"{}")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"req.body")," - An object containing the body parsed by ",(0,r.kt)("inlineCode",{parentName:"li"},"content-type"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," if no body was sent")),(0,r.kt)("h3",{id:"custom-config"},"Custom config"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"apiConfig")," object includes all configs available for API routes."),(0,r.kt)("p",null,"Every API route can export a ",(0,r.kt)("inlineCode",{parentName:"p"},"config")," object to change the default configs, which are the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export const config = {\n  apiConfig: {\n    bodyParser: {\n      sizeLimit: '1mb',\n    },\n  },\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"bodyParser")," Enables body parsing, you can disable it if you want to consume it as a ",(0,r.kt)("inlineCode",{parentName:"p"},"Stream"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export const config = {\n  apiConfig: {\n    bodyParser: false,\n  },\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"bodyParser.sizeLimit")," is the maximum size allowed for the parsed body, in any format supported by ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/visionmedia/bytes.js"},"bytes"),", like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export const config = {\n  apiConfig: {\n    bodyParser: {\n      sizeLimit: '500kb',\n    },\n  },\n}\n")),(0,r.kt)("h3",{id:"enhanced-response"},"enhanced response"),(0,r.kt)("p",null,"The response (",(0,r.kt)("inlineCode",{parentName:"p"},"res"),") includes a set of Express.js-like methods to improve the developer experience and increase the speed of creating new API endpoints, take a look at the following example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default function handler(req, res) {\n  res.status(200).json({ name: 'shuvi' })\n}\n")),(0,r.kt)("p",null,"The included helpers are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"res.status(code)")," - A function to set the status code. ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," must be a valid ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"HTTP status code")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"res.json(body)")," - Sends a JSON response. ",(0,r.kt)("inlineCode",{parentName:"li"},"body")," must be a ",(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Glossary/Serialization"},"serialiazable object")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"res.send(body)")," - Sends the HTTP response. ",(0,r.kt)("inlineCode",{parentName:"li"},"body")," can be a ",(0,r.kt)("inlineCode",{parentName:"li"},"string"),", an ",(0,r.kt)("inlineCode",{parentName:"li"},"object")," or a ",(0,r.kt)("inlineCode",{parentName:"li"},"Buffer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"res.redirect([status,] path)")," - Redirects to a specified path or URL. ",(0,r.kt)("inlineCode",{parentName:"li"},"status")," must be a valid ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"HTTP status code"),". If not specified, ",(0,r.kt)("inlineCode",{parentName:"li"},"status"),' defaults to "307" "Temporary redirect".')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Notice: api.js and page.js are conflicting, when both exist, only page.js will be enabled.")))}d.isMDXComponent=!0}}]);